{% extends "base.html" %}
{% block content %}
    
    <div class="row">
        <div class="col s12 back-button">
            <a href="{{ url_for('get_titles') }}" class="waves-effect waves-light btn"><i class="fa-solid fa-arrow-left"></i></a>            
        </div>
    </div>

    <h3 class="center-align">Summary</h3>

    <div class="row container">
        <div class="col s12 container" method="POST" action="{{ url_for('summary', titles_id=titles._id) }}">
            <div class="col s10 offset-s1 card-panel">
                {% for title in titles %}
                    <img class="materialboxed" height="auto" width="100%"                    
                        src="{{title.title_image}}">            
                    <ul class="col s12 collection with-header">
                        <li class="collection-header">
                            <h4><strong>{{title.title_name}}</strong></h4>
                        </li>
                        <li class="collection-item"><strong>Year Release: </strong>{{title.title_year}}</li>
                        <li class="collection-item"><strong>Chapters: </strong>{{title.title_chapters}}</li>
                        <li class="collection-item"><strong>Mangaka: </strong>{{title.title_mangaka}}</li>
                        <li class="collection-item"><strong>Storyline: </strong>{{title.title_story}}</li>
                    </ul>
                    {% if session.user or session.user|lower == "admin" %}
                    <div class="row">
                        <div class="col s12 center-align">
                            <!-- Modal Trigger for edit -->
                            {% if session.user|lower == title.created_by|lower or session.user|lower == "admin" %}
                            <Button class="waves-effect waves-light btn modal-trigger" href="#modal1">Edit</button>
                            <!-- Modal Trigger for edit -->
                            <Button class="waves-effect waves-light red btn modal-trigger" href="#modal2">Delete</button>
                            {% endif %}
                            <!-- Modal Trigger -->
                            <Button class="waves-effect waves-light btn modal-trigger" href="#modal3">Write a Review</button>                                
                        </div>
                    </div>
                    {% endif %}

                    <!-- Modal Structure to edit title-->
                    <div id="modal1" class="modal">
                        <form method="POST" action="{{ url_for('edit_title', title_id=title._id) }}">
                            <div class="modal-content">
                                <div class="row">
                                    <div class="input-field col s6">
                                        <input id="title_name" name="title_name" type="text" value="{{title.title_name}}" minlength="5" maxlength="50" class="validate" required>
                                        <label for="title_name">Name of Title</label>
                                    </div>
                                    <div class="input-field col s6">
                                        <input id="title_image" name="title_image" type="url" value="{{title.title_image}}" class="validate" required>
                                        <label for="title_image">Image</label>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="input-field col s12">
                                        <input id="title_year" name="title_year" type="number" value="{{title.title_year}}" minlength="4" maxlength="4" class="validate" required>
                                        <label for="title_year">Year of Release</label>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="input-field col s12">
                                        <input id="title_chapters" name="title_chapters" type="number" value="{{title.title_chapters}}" class="validate" required>
                                        <label for="title_chapters">Chapters</label>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="input-field col s12">
                                        <input id="title_mangaka" name="title_mangaka" type="text" value="{{title.title_mangaka}}" minlength="5" maxlength="25" class="validate" required>
                                        <label for="title_mangaka">Name of Mangaka</label>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="input-field col s12">
                                        <textarea id="title_story" name="title_story" class="materialize-textarea">{{title.title_story}}</textarea>
                                        <label for="title_story">Storyline</label>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col s12 center-align">
                                        <a href="{{ url_for('get_titles') }}" class="btn-large red text-shadow modal-close">
                                            Cancel
                                        </a>
                                        <button type="submit" class="btn-large modal-close">Complete</button>
                                    </div>
                                </div>                                
                            </div>
                        </form>
                    </div>
                {% endfor %}    
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Structure delete -->
    <div id="modal2" class="modal">
        {% for title in titles %}
            <div class="modal-content">
                <div class="row">
                    <div class="col s12">
                        <h4 class="center-align">Are You Sure?</h4>
                        <h5 class="center-align">{{title.title_name}} will be permanantly deleted</h5>
                    </div>
                </div>
                
                <div class="row">
                    <div class="col s12 center-align">
                        <a href="{{ url_for('get_titles') }}" class="btn-large red text-shadow modal-close">
                            No
                        </a>
                        <a href="{{ url_for('delete_title', title_id=title._id) }}" class="btn-large waves-effect waves-light btn">
                            Yes                            
                        </a>
                    </div>
                </div>
            </div>
        {% endfor %}
    </div>

    <h4 class="center-align">Reviews</h4>
    
    <div class="row container">
        <div class="col s12 container">
            {% for review in reviews %}
            <div class="col s10 offset-s1 card-panel" method="POST" action="{{ url_for('summary', titles_id=titles._id)}}">
                <ul class="col s12 collection with-header">                 
                    <h6><strong>{{review.review_name}}</strong></h6>
                    <p>{{review.review_review}}</p>
                    {% if session.user|lower == review.created_by|lower %}
                        <Button class="waves-effect waves-light btn modal-trigger" href="#modal4">Edit</button>
                        <a href="{{ url_for('delete_review', review_id=review._id) }}" class="waves-effect red waves-light btn">Delete</a>
                    {% endif %}
                </ul>
            </div>
            {% endfor %}
        </div>
    </div>             
        
    <!-- Modal Structure write a review -->
    <div id="modal3" class="modal">
        {% for title in titles %}
        <form method="POST" action="{{ url_for('add_review', title_id=title._id) }}">
            <div class="modal-content">
                <div class="row">
                    <div class="input-field col s12">
                        <input id="title_id" name="title_id" value="{{ title._id }}" type="text" class="validate"
                            required>
                        <label for="title_id">ObjectId</label>
                    </div>
                </div>
                <div class="row">
                    <div class="input-field col s12">
                        <input id="review_header" name="review_header" value="{{ title.title_name }}" type="text" class="validate" required>
                        <label for="review_header">Title</label>
                    </div>
                </div>
            
                <div class="row">
                    <div class="input-field col s12">
                        <input id="review_name" name="review_name" type="text" minlength="5" maxlength="50" class="validate"
                            required>
                        <label for="review_name">Name Your Review</label>
                    </div>
                </div>
                <div class="row">
                    <div class="input-field col s12">
                        <textarea id="review_review" name="review_review" class="materialize-textarea" required></textarea>
                        <label for="review_review">Write a Review</label>
                    </div>
                </div>
                <div class="row">
                    <div class="col s12 center-align">
                        <button type="submit" class="btn-large modal-close">Add Review</button>
                    </div>
                </div>
            </div>                                    
        </form>
        {% endfor %}
    </div>

    <!-- Modal Structure to edit review-->
    <div id="modal4" class="modal">
        {% for review in reviews %}
        <form method="POST" action="{{ url_for('edit_review', review_id=review._id) }}">
            <div class="modal-content">
                {% if session.user == review.created_by %}
                <div class="row">
                    <div class="input-field col s12">
                        <input id="review_name" name="review_name" type="text" value="{{review.review_name}}" minlength="5"
                            maxlength="50" class="validate" required>
                        <label for="review_name">Name of Review</label>
                    </div>
                    <div class="input-field col s12">
                        <input id="review_review" name="review_review" type="text" value="{{review.review_review}}" class="validate"
                            required>
                        <label for="review_review">Review</label>
                    </div>
                </div>
                
                <div class="row">
                    <div class="col s12 center-align">
                        <a href="{{ url_for('get_titles') }}" class="btn-large red text-shadow modal-close">
                            Cancel
                        </a>
                        <button type="submit" class="btn-large modal-close">Complete</button>
                    </div>
                </div>
                {% endif %}
            </div>
        </form>
        {% endfor %}
    </div>

{% endblock %}